function generateKeysSet() {
    const durations = ["1D", "7D", "30D", "60D", "90D", "365D", "FOREVER"];
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let keySet = [];

    durations.forEach(duration => {
        for (let i = 0; i < 10; i++) {
            let randomPart = '';
            for (let j = 0; j < 6; j++) {
                randomPart += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            keySet.push(`EXTAZYYDLC-${randomPart}-${duration}`);
        }
    });

    return keySet;
}

// Инициализация ключей (один раз)
if (!localStorage.getItem("extazyy_keys")) {
    const initialKeys = generateKeysSet();
    localStorage.setItem("extazyy_keys", JSON.stringify(initialKeys));
}

let keys = JSON.parse(localStorage.getItem("extazyy_keys"));

function saveKeys() {
    localStorage.setItem("extazyy_keys", JSON.stringify(keys));
}

function activateKey() {
    const inputKey = document.getElementById("activation-key").value.trim().toUpperCase();
    const message = document.getElementById("message");
    const downloadSection = document.getElementById("download-section");

    const index = keys.indexOf(inputKey);
    if (index !== -1) {
        const duration = inputKey.split("-")[2];
        const daysText = duration === "FOREVER" ? "навсегда" : `${parseInt(duration)} дней`;
        keys.splice(index, 1); // удалить использованный ключ
        saveKeys();
        message.innerHTML = `<p class="success">Ключ активирован! Доступ на ${daysText}.</p>`;
        downloadSection.classList.remove("hidden");
    } else {
        message.innerHTML = `<p class="error">Неверный или уже использованный ключ!</p>`;
        downloadSection.classList.add("hidden");
    }
}
